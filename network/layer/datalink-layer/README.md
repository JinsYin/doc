# 数据链路层（Data-Link Layer） / MAC 层

数据链路层主要解决媒体接入控制的问题。

## 要解决的问题

集线器采用 `广播` 模式，将自己收到的每一个字节都复制到其他所有端口上去。因此，需要解决以下几个问题（也是数据链路层要解决的问题）：

1. 包发给谁？谁应该接受？ ———— MAC 地址
2. 大家都在发，如何防止混乱？谁先发、谁后发？ ———— 媒体访问控制
3. 发送出现错误该怎么办？ ———— CRC

## MAC 地址

解决网络包发给谁、谁应该接受的问题，需要用到一个物理地址，即 **链路层地址**。但因为第二层主要解决媒体接入控制的问题，所以也被称为 **MAC 地址**。

### 网络包（帧）

MAC 层的网络包称为 `帧`（**Frame**），也叫 `数据帧`，帧的格式如下：

![帧格式](.images/mac-frame-format.png)

解释：

1. 最开始是 `源 MAC 地址` 和 `目标 MAC 地址`
2. 接着是 `类型`，大部分的类型是 IP 数据包，然后 IP 里面包含 TCP、UDP 以及 HTTP 等
3. 最后面是 **CRC**，即 **循环冗余检测**；通过 XOR 异或算法，来计算整个包在发送过程中是否出现了错误；解决的是第三个问题

## 媒体访问控制（MAC）

MAC 的全称是 `Medium Access Control`，即 **媒体访问控制**，控制在往媒体或介质（光纤、双绞线等）上发数据的时候，谁先发、谁后发的问题，该规则称为 **多路访问**。

解决多路访问的常见方式（以车管所管束马路上的车为例）：

* `信道划分` - 分多个车道；每个车一个车道，你走你的，我走我的
* `轮流协议` - 今天单行出行、明天双号出行，轮着来
* `随机接入协议` - 不管三七二十一，有事先出门，发现特堵，就回去（以太网就是这种方式）

## 循环冗余检验（CRC）

## 参考

* [MAC Frame Formats](http://grouper.ieee.org/groups/802/15/pub/2001/Jul01/01292r1P802-15_TG3-Proposed-Changes-to-Frame-Formats.pdf)
