# 传输层协议

传输层两个主要的协议：`TCP` 和 `UDP`；当然，还有其他协议，比如 `sctp`。

## TCP 和 UDP 的区别

| 协议 | 可靠交付？ | 传输行为   | 拥堵控制？ |
| ---- | ---------- | ---------- | ---------- |
| TCP  | Yes        | 面向数据流 | Yes        |
| UDP  | No         | 基于数据报 | No         |

* TCP 提供可靠交付，通过 TCP 连接传输的数据，可以无差错、不丢失、并且按序到达；UDP 继承了 IP 包的特性，不保证不丢失，不保证能按顺序到达
* TCP 是面向字节流的，发送的是一个流，没头没尾；UDP 继承了 IP 包的特性，基于数据报，一个个地发，一个个地收
* TCP 有拥堵控制，当意识到包丢弃了或网络环境不好时，就会根据情况调整自己的行为，看看是不是发快了，要不要发慢点；UDP 就不会，应用让我发，我就发。

因而，TCP 其实是一个有状态的服务，通俗地讲就是有脑子，精确记录着 `发送了没有`、`接收到没有`、`发送到哪个了`、`应该接收哪个了`，任何出错都不允许。而 UDP 是无状态服务，通俗地讲就是没脑子，天真无邪，发送出去就不管了。

我们可以把发送端和接收端比作河流的两端，把传输的数据包比作运送的石料。TCP 是先搭桥（即建立连接）再一车一车地运（即面向数据流），当遇到桥上运输车辆较多时可以自行控制快慢（即拥堵控制），另外河流两端都需要维护桥的连接（即维护连接状态），避免桥断掉，确保石料可以顺利到达河对岸；UDP 则是靠手一个一个地扔（即无连接且基于数据报），不管石料能否顺利到达河对岸，也不在乎扔的快慢频率。