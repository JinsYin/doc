# IP 地址

IP 地址（全称：Internet Protocol address，缩写：IP address）

## 用途/功能

* 标识主机，具体来说是指网卡（Network interface）
* 提供主机在网络中的位置，从而建立了到该主机的路径

## 版本

* IPv4：Internet Protocol version 4 （点分十进制表示，有 4 个十进制组成，每个十进制从 0 到 255，用点分隔，每部分代表一组 8 位的地址）
* IPv6：Internet Protocol version 6

| 协议版本 | 位数    | 样例                      |
| -------- | ------- | ------------------------- |
| IPv4     | 32 bit  | 172.16.254.1              |
| IPv6     | 128 bit | 2001:db8:0:1234:0:567:8:1 |

## 网络地址分类（Classful Network）

![Classful Network](.images/classful-network.png)

| 类别 | 前缀位 | IP 地址范围                      | 网络数量        | 每个网络的主机数量   | 私有 IP 地址范围                  |
| ---- | ------ | -------------------------------- | --------------- | -------------------- | --------------------------------- |
| A 类 | 0      | `0.0.0.0` ~ `127.255.255.255`    | 128（2^7）      | 16777214（2^24 - 2） | `10.0.0.0` ~ `10.255.255.255`     |
| B 类 | 10     | `128.0.0.0` ～ `191.255.255.255` | 16384（2^14）   | 65534（2^16 - 2）    | `172.16.0.0` ~ `172.31.255.255`   |
| C 类 | 110    | `192.0.0.0` ～ `223.255.255.255` | 2097152（2^21） | 254（2^8 - 2）       | `192.168.0.0` ~ `192.168.255.255` |
| D 类 | 1110   | ～                               | ～              | ～                   | ～                                |
| E 类 | 11110  | ～                               | ～              | ～                   | ～                                |

每个网络都有 `2` 个保留地址，如 `10.0.0.0/8` 这个网络有 `10.0.0.0` 和 `10.255.255.255` 两个保留地址，用于循环测试。

D 类是 **组播地址**，使用这类地址时，属于某个组的机器都能收到消息，类似于一个邮件组。

## CIDR 表示法

无类型域间选路（全称：Classless Inter-Domain Routing，缩写：**CIDR**）是基于 **可变长子网掩码**（**VLSM**）来进行任意长度的前缀的分配。

在 `分类网络`（classful network）中，C 类每个网络最多只有 254 个地址，对大多数企业来说太少了，而 B 类每个网络有 65534 个地址，这对大企业来说都太多了，导致不能充分使用 IP 地址。CIDR 打破了原来设计的 `分类网络`的表示法，将 32 位的 IP 地址分为 `网络号` 和 `主机号`，用 `斜杠` 分隔 `IP 地址` 和 `网络号的数量`，形如 `10.100.122.2/24`。

日常工作中，几乎不用划分 A 类、B 类或 C 类，所以时间长了，大家只记得 CIDR 表示法。

对 `10.100.122.2/24` 这个 CIDR 的分析如下：

* 前 `24` 位是网络号，后 `8` 位主机号
* 子网掩码是 `255.255.255.0`（`IP 地址` AND `子网掩码` = `网络号`）
* 广播地址是 `10.100.122.255`（发送消息到该地址，`10.100.0` 网络的所有机器都能收到）
* 整个网络的第一个地址是 `10.100.122.1`，往往是该网络所有机器的出口地址

根据 `16.158.165.91/22` 这个 CIDR，求该网络的子网掩码、广播地址和第一个地址：

1. `22 = 8 + 8 + 6`； `165 = 128 + 32 + 4 + 1`（二进制：`10100101`）
2. `16.158.165.91` --> `16.158.<10100101>.91`
3. 子网掩码：`255.255.<111111><00>.0`（即 `255.255.252.0`）
4. 广播地址：`16.158.<101001><11>.255`（即 `16.158.167.255`）
5. 第一个地址：`16.158.<101001><00>.1`（即 `16.158.164.1`）

利用 CIDR 表示私有 IP地址：

| 私有 IP 地址范围                  | CIDR 表示形式    |
| --------------------------------- | ---------------- |
| `10.0.0.0` ~ `10.255.255.255`     | `10.0.0.0/8`     |
| `172.16.0.0` ~ `172.31.255.255`   | `172.16.0.0/12`  |
| `192.168.0.0` ~ `192.168.255.255` | `192.168.0.0/16` |

## 参考

* [无类别域间路由](https://zh.wikipedia.org/wiki/%E6%97%A0%E7%B1%BB%E5%88%AB%E5%9F%9F%E9%97%B4%E8%B7%AF%E7%94%B1)
* [分类网络](https://zh.wikipedia.org/wiki/%E5%88%86%E7%B1%BB%E7%BD%91%E7%BB%9C)