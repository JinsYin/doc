# 文件描述符（File Descriptor）

文件描述符（File Descriptor，简称 `FD`）。

在 Unix 操作系统中，所有的外围设备（包括键盘和显示器）都被看作是文件系统中的文件，因此，所有的输入/输出都要通过读/写文件完成。

通常情况下，在读或写文件之前，必须先将这个意图通知操作系统，该过程称为 **打开文件**。如果是写一个文件，则可能需要先创建该文件，也可能需要丢弃该文件原先以存在的内容。系统检查访问者的权限（该文件是否存在？是否有权限访问它？），如果一切正常，操作系统将向程序返回一个小的非负整数，该整数称为 **文件描述符**。**任何时候对文件的输入/输出都是通过文件描述符标识文件，而不是通过文件名标识文件**（文件描述符类似于标准库中的文件指针或 MS-DOS 中的文件句柄）。系统负责维护已打开文件的所有信息，用户程序只能通过文件描述符引用文件。

当命令解释程序（即 `shell`）运行一个程序的时候，Unix 将打开 3 个文件，对应的文件描述符分别是 `0`、`1`、`2`，依次表示标准输入（stdin）、标准输出（stdout）和标准错误（stderr）。如果程序从文件 0 中读，对 1 和 2 进行写，就可以进行输入/输出而不必关心打开文件的问题。

程序的使用者可以通过 `<` 和 `>` 重定向程序的 I/O 。

```shell
prog <INPUT_FILENAME >OUTPUT_FILENAME
```

这种情况下，shell 把文件描述符 0 和 1 的默认赋值改变为指定的文件。

在任何情况下，文件赋值的改变都不是由程序完成的，而是有 shell 完成的。只要程序使用文件 `0` 作为输入，使用文件 `1` 和 `2` 作为输出，它就不会知道（也不用关心）程序的输入从哪里来，并输出到那里去。

## 命令

```bash
# stdin 从 /dev/pts/19 读取数据，写入到了 C00003491.png
$ ls /proc/772894/fd
total 0
dr-x------ 2 yin yin  0 10月 22 21:06 ./
dr-xr-xr-x 9 yin yin  0 10月 22 21:06 ../
lrwx------ 1 yin yin 64 10月 22 21:09 0 -> /dev/pts/19
lrwx------ 1 yin yin 64 10月 22 21:09 1 -> /dev/pts/19
lrwx------ 1 yin yin 64 10月 22 21:09 2 -> /dev/pts/19
lr-x------ 1 yin yin 64 10月 22 21:09 3 -> /media/yin/Elements/1-ChartMap_v2_en/L12/R00001b92/C00003491.png
```