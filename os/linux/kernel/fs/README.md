# 文件系统（File System）

文件系统是文件和目录的组织集合。

## 文件系统结构（Filesystem Orgnization）

在文件系统中，用来分配空间的基本单位是 _逻辑块_（Logic Block），对应于该文件系统所在磁盘设备上若干个**连续的** _物理块_（Block）。所以，文件系统逻辑块的大小是物理块大小的整数倍，而物理块大小通常是 512 字节（扇区大小）的整数倍（取决于设备类型）。另外，命令 `mkfs` 创建文件系统时，可以指定逻辑块的大小。

[磁盘分区](../../../../computer/hardware/devices/disk/partition.md) 与文件系统的关系：

```graph
                 +------------+------------+------------+
            磁盘  |    分区    |    分区     |    分区     |
                 +------------+------------+------------+
                              |            |
                              v            v
        +---------------------+            +---------------------+
        v                                                        v
        +---------+---------+-----------+------------------------+
文件系统 |  引导块  |  超级块  |  inode 表  |         数据块          |
        +---------+---------+-----------+------------------------+

                          （磁盘分区和文件系统布局）
```

文件系统组成部分（均指逻辑块）：

| 组成部分                                          | 描述                                                                                                                                                                                             |
| ------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 引导块（boot block）                              | 位于文件系统的第一个逻辑块（即前几个扇区）；引导块包含加载操作系统的初始化引导程序，不被文件系统所使用；操作系统虽然只需一个引导块，但所有文件系统都设有引导块（绝对部分都未使用）               |
| 超级块（super block）                             | 紧随引导块之后的一个独立块，存放文件系统的状态信息（见 `man stat`），包括但不限于：<br> * inode 表的容量 <br> * 逻辑块的大小 <br> * 文件系统的总大小（以逻辑块来计算）<br> * 根目录的 inode 编号 |
| inode 表（或 _inode 线性表_ 或 _inode 线性数组_） | 文件系统中的每个文件都有且只有一个 inode，对应于 inode 表中一条唯一的记录；inode 由 “inode 编号” 来标识                                                                                          |
| 数据块（data blocks）                             | 用于存储数据；文件系统的大部分空间都是数据块，以存放驻留于文件系统之上的文件和目录                                                                                                               |

## inode



## 相关命令

* `mkfs` - 创建文件系统
* `ls -li`

## 系统调用

## 示例

```sh
# 查看当前内核所知道的文件系统
$ cat /proc/filesystems

# 第一列是 inode 编号
$ ls -li /etc/passwd
702721 -rw-r--r--  1 root  wheel  6804  2 26 11:36 /etc/passwd
```

## 参考

* [Filesystems in the Linux kernel](https://www.kernel.org/doc/html/latest/filesystems/index.html)
* [Unix Filesystem Organization](https://web.cs.wpi.edu/~rek/DCS/D04/UnixFileSystems.html)