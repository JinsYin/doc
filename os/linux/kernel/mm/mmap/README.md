# 内存映射

调用 `mmap()` 系统调用的进程，会在其虚拟地址空间中创建一个新的内存映射。

## 分类

| -        | 描述                                                                                                                                   |
| -------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| 文件映射 | 将文件的部分区域映射到调用进程的虚拟内存；映射完成后，对文件内容的访问则转化为对相应内存区域的字节操作；映射页面会按需自动从文件中加载 |
| 匿名映射 | 其映射页面的内容会被初始化为 0                                                                                                         |

## 共享

进程所映射的内存可以与其他进程的映射共享，共享方式如下：

* 两个进程都针对某一文件的相同部分加以映射
* 由 `fork()` 创建的子进程从父进程处继承映射

## 映射的内存区域

```sh
$ cat /proc/self/maps
address                   perms  offset   dev    inode                      pathname
00400000-0040b000         r-xp 00000000 fd:01 12613123                           /usr/bin/cat
0060b000-0060c000         r--p 0000b000 fd:01 12613123                           /usr/bin/cat
0060c000-0060d000         rw-p 0000c000 fd:01 12613123                           /usr/bin/cat
01b24000-01b45000         rw-p 00000000 00:00 0                                  [heap]
7f0c2d7f6000-7f0c33d20000 r--p 00000000 fd:01 12820341                   /usr/lib/locale/locale-archive
7f0c33d20000-7f0c33ee2000 r-xp 00000000 fd:01 10079                      /usr/lib64/libc-2.17.so
7f0c33ee2000-7f0c340e2000 ---p 001c2000 fd:01 10079                      /usr/lib64/libc-2.17.so
7f0c340e2000-7f0c340e6000 r--p 001c2000 fd:01 10079                      /usr/lib64/libc-2.17.so
7f0c340e6000-7f0c340e8000 rw-p 001c6000 fd:01 10079                      /usr/lib64/libc-2.17.so
7f0c340e8000-7f0c340ed000 rw-p 00000000 00:00 0
7f0c340ed000-7f0c3410f000 r-xp 00000000 fd:01 10072                      /usr/lib64/ld-2.17.so
7f0c34304000-7f0c34307000 rw-p 00000000 00:00 0
7f0c3430d000-7f0c3430e000 rw-p 00000000 00:00 0
7f0c3430e000-7f0c3430f000 r--p 00021000 fd:01 10072                      /usr/lib64/ld-2.17.so
7f0c3430f000-7f0c34310000 rw-p 00022000 fd:01 10072                      /usr/lib64/ld-2.17.so
7f0c34310000-7f0c34311000 rw-p 00000000 00:00 0
7ffef8e21000-7ffef8e42000 rw-p 00000000 00:00 0                          [stack]
7ffef8eb6000-7ffef8eb8000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
```
