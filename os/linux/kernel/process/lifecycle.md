# 进程生命周期

## 进程状态

| 状态码 | 状态                                                                 | 查询命令                             | 描述                                                                                                                                                                        |
| ------ | -------------------------------------------------------------------- | ------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **R**  | 正在运行（Running）或可运行（Runnable，即在 _run queue_ 中等待运行） | `ps aux | awk '$8=="R"'`（尝试多次） | 对应于教科书中的 **运行**（RUNNING）和 **就绪**（READY）状态：<br> * 运行：进程获得 CPU 时间片 <br> * 就绪：进程已获得除 CPU 以外的其他系统资源（意味着也会消耗内存等资源） |
| **S**  | 可中断的睡眠（Interruptible Sleep）                                  | `ps aux | awk '$8=="S"'`             | 进程等待某些条件存在或某些 [信号](../signal/README.md) 到达（亦称 _阻塞_），比如程序中调用 `sleep()` 函数                                                                   |
| **D**  | 不可中断的睡眠（Uninterruptible Sleep，也称为 Disk Sleep）           | `ps aux | awk '$8=="D"'`             | 类似于 _可中断睡眠_，不同的是接收到信号时，进程不会被唤醒并切换为 _可运行_，意味着无法杀死（`kill -9`）该进程                                                               |
| **Z**  | 僵尸进程（Zombie）                                                   | `ps aux | awk '$8=="Z"'`             | 进程已终止，但其父进程尚未发出 `wait4()` 系统调用。被其父进程终止但没有被回收的进程                                                                                         |
| **T**  | 终止（Terminated）                                                   | `ps aux | awk '$8=="T"'`             | 如果进程收到 SIGSTOP、SIGTSTP、SIGTTIN 或 SIGTTOU 信号（其默认操作是停止发送它们的进程）或者在调试时收到任何信号，则会出现此状态                                            |

## 状态切换

![Process state](.images/process-state.png)

| 切换过程      | 方式方法                               |
| ------------- | -------------------------------------- |
| 运行 --> 就绪 |                                        |
| 运行 --> 终止 | 1. 进程执行完成 <br> 2. 明确杀死该进程 |

## 术语

* 可运行（Runnable） == 就绪（Ready） == 等待（Waiting）
* 运行队列（Run queue） == 就绪队列（Ready queue）
* 可中断的睡眠（Interruptible） == 阻塞（Blocked）

## `ps`

ps（**p**rocess **s**tate）显示当前正在运行的进程。

## 参考

* [Process state](https://en.wikipedia.org/wiki/Process_state)
* [Linux 进程状态](https://www.cnblogs.com/diegodu/p/9167671.html)